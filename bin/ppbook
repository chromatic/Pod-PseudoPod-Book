#!/usr/bin/perl

use Pod::PseudoPod::Book;

my %deps =
(
    create        => [],
    buildcredits  => [],
    buildchapters => [qw( buildcredits )],
    buildhtml     => [qw( buildchapters buildcredits )],
    buildepub     => [qw( buildcredits buildchapters buildhtml )],
);

my $app = Pod::PseudoPod::Book->new;
usage("Missing command") unless @ARGV;
usage("Unknown command (@ARGV)") unless $app->plugin_for( $ARGV[0] );

my ($cmd, $opt, @args) = $app->get_command(@ARGV);

for my $command (@{ $deps{$ARGV[0]} }, $cmd)
{
    $app->execute_command( $app->plugin_for($command), $opt, @args );
}

exit;

sub usage
{
    my $txt = shift;
    print "$txt\n" if $txt;
    print "Available commands:\n";
    foreach my $cmd (sort keys %deps) {
        print "   $cmd\n";
    }
    exit;
}
